# Zend Expressive Authorization RBAC

This component provides [Role-Based Access Control](https://en.wikipedia.org/wiki/Role-based_access_control)
(RBAC) authorization abstraction for [zend-expressive-authorization](https://github.com/zendframework/zend-expressive-authentication)
library.

RBAC is based on the idea or **roles**. Typically, in a web application we have
users identified by **identity** (e.g. username, email, etc). Each user has one
or more roles (e.g. admin, editor, guest). Each role has a **permission**, to
perform some actions (e.g. access an URL, execute specific web API calls).

In a typical RBAC system:

- an **identity** has one or more roles;
- a **role** requests access to a permission;
- a **permission** is given to a role.

Thus, RBAC has the following model:

- many to many relationship between identities and roles;
- many to many relationship between roles and permissions;
- roles can have a parent role.

In order to have a RBAC system we need to have **identities** in place. In
our scenario, the users are generated by an authentication system, provided by
[zend-expressive-authentication](https://github.com/zendframework/zend-expressive-authentication).
This library, provides a PSR-7 object attribute (named
`Zend\Expressive\Authentication\UserInterface`) if a user is authenticated.
The RBAC system uses this object to get information about the user's identity.


## Configure an RBAC system

You can configure your RBAC using a configuration file, as follows:

```php
// config/autoload/authorization.local.php
return [
    // ...
    'zend-expressive-authorization-rbac' => [
        'roles' => [
            'administrator' => [],
            'editor'        => ['administrator'],
            'contributor'   => ['editor'],
        ],
        'permissions' => [
            'contributor' => [
                'admin.dashboard',
                'admin.posts',
            ],
            'editor' => [
                'admin.publish',
            ],
            'administrator' => [
                'admin.settings',
            ],
        ],
    ]
];

```

In this example, we designed an RBAC system with 3 roles: `administator`,
`editor`, and `contributor`. We defined an hierarchy of roles as follows:

- `administrator` has no parent role;
- `editor` has `administrator` as parent, that means `administrator` inherits
the permissions of the `editor`;
- `contributor` has `editor` as parent, that means `editor` inherits the
permissions of `contributor`, and following the chain, `administator` inherits
the permission of `contributor`.

For each role we specified an array of permissions. As you can notice, a
permission is just a string, it can represent anything. In our implementation
of `zend-expressive-authorization-rbac` this string represents a route name.
That means, the `contributor` role can access the routes `admin.dashboard` and
`admin.posts` but he/she cannot access the routes `admin.publish` (assigned to
`editor` role) and `admin.settings` (assigned to `administrator`).

If you want to change the authorization logic for each permission, you can write
your own `Zend\Expressive\Authorization\AuthorizationInterface` implementing
the following function:

```php
isGranted(string $role, ServerRequestInterface $request) : bool
```

where `$role` is the role and `$request` is the PSR-7 HTTP request to authorize.

> This library uses the [zend-permissions-rbac](https://github.com/zendframework/zend-permissions-rbac)
> library to implement the RBAC system. If you want to know more about the usage
> of this library read this blog post 
> [Manage permissions with zend-permissions-rbac](https://framework.zend.com/blog/2017-04-27-zend-permissions-rbac.html)
